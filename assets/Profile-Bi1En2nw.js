import{c as P,r as t,g as I,j as e,L as J,b as $,h as te,p as le,H as ne,B as f,M as S}from"./index-BV6FT8Uv.js";import{I as d}from"./input-uq7BhVoG.js";import{H as V}from"./heart-CLJtUlTb.js";import{d as re,g as F,h as ie,a as de,e as oe,p as ce}from"./Profile-00G9MeuV.js";import{C as me}from"./Confirm-DnFIMAed.js";import{P as he}from"./plus-0Cvm1htv.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],ge=P("camera",xe);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]],ue=P("pen-line",pe);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],je=P("pen",fe);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]],we=P("trash-2",ye),U="http://localhost:5000/api";function Ne(){const[v,g]=t.useState([]),[L,j]=t.useState(!0),[C,p]=t.useState(!1);t.useEffect(()=>{let a=[];try{a=JSON.parse(I("wishlist")||"[]")}catch{a=[]}if(!a.length){j(!1);return}(async()=>{const i=[];for(const x of a)try{const l=await(await fetch(`${U}/product/${x}`)).json();l?.product&&i.push(l.product)}catch(y){console.error(`Failed to fetch product ${x}`,y)}g(i),j(!1)})()},[]);const o=a=>{if(!C){p(!0);try{let r=JSON.parse(I("wishlist")||"[]");r.includes(a)?r=r.filter(i=>i!==a):r.push(a),te("wishlist",JSON.stringify(r)),g(i=>i.filter(x=>r.includes(x.id)))}catch(r){console.error("Error updating wishlist",r)}finally{p(!1)}}};return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-2xl p-6 mt-6 shadow-sm",children:[e.jsxs("h2",{className:"text-xl font-semibold mb-4 flex items-center gap-2",children:["Wishlist ",e.jsx(V,{})]}),L?e.jsx("p",{className:"text-sm text-gray-500",children:"Loading wishlist..."}):v.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"No items in your wishlist yet."}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:v.map(a=>e.jsxs("div",{className:"rounded-lg shadow-lg bg-white sm:min-h-[270px] relative",children:[e.jsx("span",{onClick:()=>o(a.id),className:"p-2 rounded-2xl backdrop-blur-lg absolute top-4 right-4 bg-white/15 cursor-pointer",children:e.jsx(V,{size:20,fill:"orange",stroke:"orange",className:"transition-transform duration-200 hover:scale-110"})}),e.jsx(J,{to:`/product/${a.id}`,className:"block",children:e.jsx($.LazyLoadImage,{effect:"opacity",loading:"lazy",fetchpriority:"high",src:U+a.img1,srcSet:U+a.img1,alt:a.title,className:"w-full object-cover mb-2 rounded-xl cursor-pointer"})}),e.jsxs("div",{className:"p-2 pt-0",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 pb-1 flex-wrap",children:[e.jsx("h4",{className:"text-sm sm:text-md truncate",children:e.jsx(J,{to:`/product/${a.id}`,children:a.title})}),e.jsxs("p",{className:"text-gray-600 md:text-sm text-xs text-orange-500 truncate",children:[a.stock," ",a.stock<=1?"item":"items"]})]}),e.jsxs("p",{className:"text-gray-600 md:text-sm text-xs font-semibold truncate",children:["$",a.price]})]})]},a.id))})]})}const B="http://localhost:5000/api",Pe=()=>{const[v,g]=t.useState(!1),[L,j]=t.useState(!1),[C,p]=t.useState(!1),[o,a]=t.useState(!1),[r,i]=t.useState([]),[x,y]=t.useState(""),[l,D]=t.useState(),[m,w]=t.useState(),[T,H]=t.useState(!1),R=le();t.useEffect(()=>{const s=I("user"),n=s?JSON.parse(s):null;if(!n){R("/login");return}D(n)},[R]);const[h,q]=t.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[c,A]=t.useState({address_line:"",city:"",state:""}),[G,M]=t.useState(null),[_,E]=t.useState({open:!1,id:null});t.useEffect(()=>{(async()=>{const n=await F();n&&i(n)})()},[]);const W=s=>{w({...m,[s.target.name]:s.target.value})},O=s=>{q({...h,[s.target.name]:s.target.value})},u=s=>{A({...c,[s.target.name]:s.target.value})},K=async()=>{a(!0);const s=await ie({Firstname:m?.firstname,Lastname:m?.lastname,image:m?.photoFile||null});s&&(D(s),w(s)),a(!1),g(!1)},Q=async(s,n,N,b,ae)=>{try{n(!0),await N(s?.address_line,s?.city,s?.state);const z=await b();ae(z||[])}catch(z){console.error("Error adding address:",z)}finally{n(!1),k()}},X=s=>{const n=s.target.files[0];if(n){w(b=>({...b,photoFile:n}));const N=new FileReader;N.onloadend=()=>{w(b=>({...b,photo:N.result}))},N.readAsDataURL(n)}},Y=async()=>{h?.newPassword===h?.confirmPassword&&(a(!0),await de(h?.currentPassword,h?.newPassword),a(!1),j(!1))},Z=()=>{y("add"),A({address_line:"",city:"",state:""}),M(null),p(!0)},ee=s=>{y("edit"),M(s.id),A({address_line:s.address_line,city:s.city,state:s.state}),p(!0)},k=()=>{p(!1),M(null),A({address_line:"",city:"",state:""})},se=async()=>{a(!0);const s=await oe(G,c);i(await s?.addresses||[]),a(!1),k()};return e.jsxs(e.Fragment,{children:[e.jsx(ne,{children:e.jsx("title",{children:"Fenzo | Profile"})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10 text-gray-800",children:[e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-2xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold mb-1",children:"User Details"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Manage your personal information"})]}),e.jsxs(f,{className:"text-sm flex items-center gap-1",onClick:()=>{w(l),g(!0)},children:[e.jsx(je,{})," Edit"]})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-6 flex-wrap",children:[!T&&l?.image?e.jsx($.LazyLoadImage,{effect:"opacity",src:B+l?.image,alt:"Avatar",fetchpriority:"high",onLoad:()=>H(!1),loading:"lazy",onError:()=>H(!0),decoding:"async",className:"w-22 h-22 rounded-full object-cover"}):e.jsx("span",{className:"w-16 h-16 max-w-16 max-h-16 rounded-full object-cover bg-orange-500 text-white flex justify-center items-center font-bold text-4xl",children:l?.firstname?.split("")[0]+l?.lastname?.split("")[0]||"?"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-medium",children:l?.firstname!==void 0&&l?.username||l?.firstname+" "+l?.lastname||"Anonymous"}),e.jsx("p",{className:"text-gray-600 text-sm",children:l?.email}),e.jsx("p",{className:"text-gray-600 text-sm",children:l?.phone})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-2xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold mb-1",children:"Addresses"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Manage shipping addresses"})]}),e.jsxs(f,{className:"text-sm flex items-center gap-1",disabled:r.length===2,onClick:Z,children:[e.jsx(he,{})," Add Address"]})]}),e.jsx("div",{className:"mt-4 space-y-2",children:r.length>0?r.map(s=>e.jsxs("div",{className:"border p-3 rounded-lg text-sm text-gray-700 flex justify-between items-center",children:[e.jsxs("span",{children:[s.address_line,", ",s.city,", ",s.state]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:()=>ee(s),className:"text-blue-600 hover:text-blue-800",children:e.jsx(ue,{size:20})}),e.jsx("button",{onClick:()=>E({open:!0,id:s.id}),className:"text-red-600 hover:text-red-800",children:e.jsx(we,{size:20})})]})]},s.id)):e.jsx("p",{className:"text-gray-500 text-sm",children:"No addresses found."})})]})]}),e.jsx(Ne,{}),e.jsxs(S,{isOpen:v,toggle:()=>g(!1),animateModal:!0,children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Edit User Details"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex flex-col items-center mb-4",children:e.jsxs("label",{className:"cursor-pointer text-blue-600 text-sm",children:[m?.photo||l?.image?e.jsx($.LazyLoadImage,{effect:"opacity",fetchpriority:"high",loading:"lazy",src:m?.photo||B+l?.image,alt:"Profile",className:"w-24 h-24 rounded-full object-cover mb-2"}):e.jsx("span",{className:"w-24 h-24 max-w-24 max-h-24 rounded-full relative object-cover bg-orange-500 text-white flex justify-center items-center font-bold text-4xl",children:e.jsx(ge,{className:"absolute",size:60})}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:X})]})}),e.jsx(d,{name:"firstname",placeholder:"Firstname",value:m?.firstname||"",onChange:W}),e.jsx(d,{name:"lastname",placeholder:"Lastname",value:m?.lastname||"",onChange:W}),e.jsx(f,{className:"text-sm w-full mt-2",onClick:K,disabled:o,children:o?"Saving...":"Save"})]})]}),e.jsxs(S,{isOpen:L,toggle:()=>j(!1),animateModal:!0,children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Change Password"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(d,{name:"currentPassword",placeholder:"Current Password",type:"password",value:h?.currentPassword,onChange:O}),e.jsx(d,{name:"newPassword",placeholder:"New Password",type:"password",value:h?.newPassword,onChange:O}),e.jsx(d,{name:"confirmPassword",placeholder:"Confirm New Password",type:"password",value:h?.confirmPassword,onChange:O}),e.jsx(f,{className:"text-sm w-full mt-2",onClick:Y,disabled:o,children:o?"Saving...":"Save"})]})]}),e.jsxs(S,{isOpen:C&&x==="add",toggle:k,animateModal:!0,children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Add Address"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(d,{name:"address_line",placeholder:"Address Line",value:c?.address_line,onChange:u}),e.jsx(d,{name:"city",placeholder:"City",value:c?.city,onChange:u}),e.jsx(d,{name:"state",placeholder:"State",value:c?.state,onChange:u}),e.jsx(f,{className:"text-sm w-full mt-2",onClick:()=>Q(c,a,ce,F,i),disabled:o,children:o?"Saving...":"Save"})]})]}),e.jsxs(S,{isOpen:C&&x==="edit",toggle:k,animateModal:!0,children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Edit Address"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(d,{name:"address_line",placeholder:"Address Line",value:c?.address_line,onChange:u}),e.jsx(d,{name:"city",placeholder:"City",value:c?.city,onChange:u}),e.jsx(d,{name:"state",placeholder:"State",value:c?.state,onChange:u}),e.jsx(f,{className:"text-sm w-full mt-2",onClick:se,disabled:o,children:o?"Updating...":"Update"})]})]}),e.jsx(me,{open:_.open,setOpen:s=>E(n=>({...n,open:s})),title:"Delete Address",description:"Are you sure you want to delete this address? This action cannot be undone.",onConfirm:async s=>{s&&_.id&&(await re(_.id),i(await F()||[])),E({open:!1,id:null})}})]})]})};export{Pe as default};
