import{c as F,u as O,r as a,j as e,B as k,m as L,C as D,n as U,o as q,p as H,H as I,e as T,g as z,L as E,b as J,h as _}from"./index-BV6FT8Uv.js";/* empty css                 */import{r as X,a as G}from"./Carts-0ogl0RAy.js";import{C as V}from"./CustomSelect-CAhV17a_.js";import{H as Y}from"./heart-CLJtUlTb.js";import{X as K}from"./x-9FGet_Yo.js";import{P as Q}from"./plus-0Cvm1htv.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]],Z=F("loader",W),ee=({placeholder:s,isLoading:t,className:r,error:d,children:l})=>{const[o,f]=a.useState(!1),x=a.useRef(null),p=a.useRef(null),m=a.useRef(null);a.useEffect(()=>{const n=i=>{x.current?.contains(i.target)||p.current?.contains(i.target)||m.current?.contains(i.target)||f(!1)};return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[]);const u=a.useMemo(()=>{if(!o||!x.current)return{};const n=x.current.getBoundingClientRect();return{top:n.bottom+window.scrollY+4+"px",left:n.left+window.scrollX+"px",width:n.width+"px",position:"absolute"}},[o]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{ref:x,className:`inline-block w-full max-w-[200px] ${r}`,children:[e.jsxs(k,{type:"button",onClick:()=>f(n=>!n),disabled:t,className:"w-full flex items-center justify-between px-4 py-2 text-sm border border-gray-300 rounded-lg bg-white shadow-sm hover:border-orange-400 hover:bg-orange-50 transition-colors duration-200",children:[e.jsx("span",{className:`${s?"text-gray-900":"text-gray-400"} truncate`,children:s}),o?e.jsx(D,{size:18}):e.jsx(U,{size:18})]}),d&&e.jsx("span",{className:"text-sm text-red-500",children:d})]}),o&&L.createPortal(e.jsx("div",{ref:p,className:"hidden md:block bg-white border border-gray-200 rounded-lg shadow-lg z-50 max-h-60 overflow-y-auto min-w-64",style:u,children:l}),document.body),o&&L.createPortal(e.jsx("div",{ref:m,className:"fixed md:hidden left-1/2 top-[50%] transform -translate-x-1/2 -translate-y-1/2 w-[90%] sm:w-[80%] bg-white border border-gray-200 rounded-lg shadow-lg z-50 max-h-96 overflow-y-auto",children:l}),document.body)]})};function se({min:s,max:t,onChange:r,initialValues:d}){const[l,o]=O(),f=Number(l.get("minPrice"))||null,x=Number(l.get("maxPrice"))||null,p=f??d?.minValue??s,m=x??d?.maxValue??t,[u,n]=a.useState({minValue:p,maxValue:m}),[i,g]=a.useState({minValue:p,maxValue:m});a.useEffect(()=>{const y=Number(l.get("minPrice"))||s,w=Number(l.get("maxPrice"))||t,b=Math.max(s,Math.min(t,y)),j=Math.max(s,Math.min(t,w));n({minValue:b,maxValue:j}),g({minValue:b,maxValue:j})},[s,t,l]);const v=a.useCallback(y=>{const{name:w,value:b}=y.target;g(j=>({...j,[w]:b}))},[]),C=a.useCallback(()=>{let y=Number(i.minValue)||s,w=Number(i.maxValue)||t;if(y=Math.max(s,Math.min(t,y)),w=Math.max(s,Math.min(t,w)),y>w)return;const b={minValue:y,maxValue:w};n(b),r?.(b);const j=Object.fromEntries(l.entries());delete j.minPrice,delete j.maxPrice,o({...j,minPrice:b.minValue,maxPrice:b.maxValue})},[i,s,t,r,l,o]);return e.jsx(ee,{placeholder:`Price: $${u.minValue} - $${u.maxValue}`,className:"w-full max-w-[250px]",children:e.jsxs("div",{className:"p-4 bg-white rounded-xl shadow-sm border border-gray-200 space-y-4 w-full",children:[e.jsx("h4",{className:"font-bold text-gray-700",children:"Filter by Price"}),e.jsxs("div",{className:"flex items-center gap-4 justify-around",children:[e.jsx("input",{type:"number",name:"minValue",value:i.minValue,onChange:v,className:"w-20 border border-gray-300 rounded px-2 py-1 focus:ring-2 focus:ring-orange-500",min:s,max:i.maxValue||t}),e.jsx("span",{className:"text-gray-500",children:"-"}),e.jsx("input",{type:"number",name:"maxValue",value:i.maxValue,onChange:v,className:"w-20 border border-gray-300 rounded px-2 py-1 focus:ring-2 focus:ring-orange-500",min:i.minValue||s,max:t})]}),e.jsx(k,{onClick:C,className:"bg-orange-500 hover:bg-orange-600 text-white px-4 py-1 rounded mt-2 w-full",children:"Apply"})]})})}const te="http://localhost:5000/api",ae=["All","Electronics","Clothing","Books","Furniture","Sports","Beauty","Toys"];function re(s){const t={};return s?.forEach((r,d)=>{r&&r.trim()!==""&&r!=="All"&&!["minPrice","maxPrice","query"].includes(d)&&(t[d]=r.trim())}),t}function ge(){const s=q(),t=H(),r=a.useMemo(()=>new URLSearchParams(s.search),[s.search]),[d,l]=a.useState([]),[o,f]=a.useState({}),[x,p]=a.useState(!1),[m,u]=a.useState(null),[n,i]=a.useState(1),g=30,[v,C]=a.useState({minValue:Number(r.get("minPrice"))||0,maxValue:Number(r.get("maxPrice"))||1e5});a.useEffect(()=>{(async()=>{p(!0),i(1);const N={...re(r),query:r.get("query"),minPrice:r.get("minPrice"),maxPrice:r.get("maxPrice"),discount:r.get("discount")};try{const P=await T(N),{products:B,maxPriceRange:M,minPriceRange:R}=P;M!==void 0&&R!==void 0&&C({maxValue:M,minValue:R}),l(B||[])}catch(P){console.error("Search error:",P),l([])}finally{p(!1)}})()},[r]);const y=a.useCallback((c,h)=>{const N=new URLSearchParams(s.search);!h||h==="All"?N.delete(c):N.set(c,h),t({search:N.toString()})},[s.search,t]),w=a.useCallback(c=>{const h=new URLSearchParams(s.search);h.set("minPrice",c.minValue),h.set("maxPrice",c.maxValue),t({search:h.toString()})},[s.search,t]),b=a.useCallback(()=>{t({search:""}),C({minValue:0,maxValue:1e5}),i(1)},[t]),j=()=>i(c=>c+1),$=async c=>{u(c);try{const h=o[c];(h?await X(c):await G(c))&&f(P=>({...P,[c]:!h}))}catch(h){console.error("Toggle cart error:",h)}finally{u(null)}},S=a.useMemo(()=>d.slice(0,n*g),[d,n]),A=d.length>S.length;return e.jsxs("main",{className:"flex-1 p-1 lg:p-4 bg-gray-200 pb-16",children:[e.jsx(I,{children:e.jsx("title",{children:"Search Products | Store"})}),e.jsx("div",{className:"bg-white z-10 pt-4 pb-4 rounded-md px-4",children:e.jsx(le,{isLoading:x,selectedBrand:r.get("brand")||"",selectedColor:r.get("color")||"",selectedSize:r.get("size")||"",selectedCategory:r.get("category")||"",priceRange:v,setPriceRange:w,handleResetFilters:b,categories:ae,updateFilter:y,searchParams:r})}),e.jsx("div",{className:"grid md:gap-5 gap-3 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 grid-cols-2 mt-4 min-h-[200px]",children:x?Array.from({length:8}).map((c,h)=>e.jsx(oe,{},h)):S.length===0?e.jsx("p",{className:"text-gray-500 col-span-full",children:"No products match the current filters."}):S.map(c=>e.jsx(ne,{product:c,inCart:!!o[c.id],toggleCart:$,loadingProductId:m},c.id))}),A&&!x&&e.jsx("div",{className:"flex justify-center mt-6 pb-16",children:e.jsx(k,{onClick:j,className:"bg-orange-500 hover:bg-orange-600 text-white px-6 py-2 rounded shadow",children:"Load More"})})]})}const ne=a.memo(({product:s,inCart:t,toggleCart:r,loadingProductId:d})=>{const[l,o]=a.useState(!1),[f,x]=a.useState(!1);a.useEffect(()=>{try{JSON.parse(z("wishlist")||"[]").includes(s.id)&&o(!0)}catch(u){console.error(u)}},[s.id]);const p=u=>{if(u.stopPropagation(),!f){x(!0);try{let n=JSON.parse(z("wishlist")||"[]");n=l?n.filter(i=>i!==s.id):[...n,s.id],_("wishlist",JSON.stringify(n)),o(!l)}catch(n){console.error(n)}finally{x(!1)}}},m=d===s.id;return e.jsxs("div",{className:"rounded-lg shadow-lg bg-white sm:min-h-[270px] relative",children:[e.jsx("span",{className:"p-2 rounded-2xl backdrop-blur-lg absolute top-4 right-4 bg-white/15",children:e.jsx(Y,{size:20,onClick:p,fill:l?"orange":"transparent",stroke:l?"orange":"white",className:`cursor-pointer transition-transform duration-200 hover:scale-110 ${f?"opacity-50 cursor-not-allowed":""}`})}),e.jsx(E,{to:`/product/${s.id}`,className:"block",children:e.jsx(J.LazyLoadImage,{src:te+s.img1,alt:s.title,fetchpriority:"high",loading:"lazy",effect:"opacity",className:"w-full object-cover mb-2 rounded-xl cursor-pointer"})}),e.jsxs("div",{className:"p-2 pt-0",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 pb-1 flex-wrap",children:[e.jsx("h4",{className:"text-sm sm:text-md line-clamp-2",children:e.jsx(E,{to:`/product/${s.id}`,children:s.title})}),e.jsxs("p",{className:"text-gray-600 md:text-sm text-xs text-orange-500 truncate",children:[s.stock," ",s.stock<=1?"item":"items"]})]}),e.jsxs("div",{className:"flex justify-between items-center gap-1",children:[e.jsxs("p",{className:"text-gray-600 md:text-sm text-xs font-semibold truncate",children:["$",s.price]}),e.jsx("button",{onClick:()=>r(s.id),disabled:m||s.stock===0,className:`mt-2 ${t?"bg-red-500":"bg-orange-500"} text-white px-2 py-1 text-sm rounded flex items-center ${m?"opacity-60 cursor-not-allowed":""}`,title:t?"Remove from cart":"Add to cart",children:m?e.jsx(Z,{size:18}):t?e.jsx(K,{size:18}):e.jsx(Q,{size:18})})]})]})]})}),le=a.memo(({isLoading:s,selectedBrand:t,selectedColor:r,selectedSize:d,selectedCategory:l,priceRange:o,setPriceRange:f,handleResetFilters:x,categories:p,updateFilter:m,searchParams:u})=>{const n=u.get("minPrice"),i=u.get("maxPrice");return e.jsxs("div",{className:"w-full flex flex-nowrap gap-4 items-start max-w-screen overflow-x-auto pe-3",children:[e.jsx(V,{placeholder:"Category",options:p,selectedValue:l,onChange:g=>m("category",g),isLoading:s}),e.jsx(V,{placeholder:"Brand",options:["All","Brand A","Brand B"],selectedValue:t,onChange:g=>m("brand",g),isLoading:s}),e.jsx(V,{placeholder:"Color",options:["All","Red","Blue"],selectedValue:r,onChange:g=>m("color",g),isLoading:s}),e.jsx(V,{placeholder:"Size",options:["All","Small","Large"],selectedValue:d,onChange:g=>m("size",g),isLoading:s}),e.jsx(V,{placeholder:"Discount",options:["All","10%+","25%+","50%+","75%+"],selectedValue:u.get("discount")||"",onChange:g=>m("discount",g),isLoading:s}),e.jsx(se,{min:o.minValue??0,max:o.maxValue??1e5,onChange:f,initialValues:{minValue:Number(n)||o.minValue,maxValue:Number(i)||o.maxValue}}),e.jsx(k,{onClick:x,className:"bg-gray-200 px-4 py-2 rounded text-sm hover:bg-gray-300 truncate min-w-20",disabled:s,children:"Reset Filters"})]})}),oe=()=>e.jsxs("div",{className:"border rounded shadow p-3 animate-pulse",children:[e.jsx("div",{className:"w-full h-40 bg-gray-300 mb-2"}),e.jsx("div",{className:"h-4 bg-gray-300 mb-1 w-3/4"}),e.jsx("div",{className:"h-4 bg-gray-300 w-1/2"}),e.jsx("div",{className:"mt-2 h-6 bg-gray-300 w-1/2 rounded"})]});export{ge as default};
